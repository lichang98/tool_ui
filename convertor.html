<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Darwin IDE</title>
  </head>
  <body>

    <!-- 顶部标题栏 -->
    <nav>
      <div class="nav-wrapper">
        <a href="#!" class="right" style="margin-right: 0;">
          <img src="./resources/convertor_log.png" style="width: 105px;height: 100%;margin-left: 0;"></img>
        </a>
        <a href="#!" class="brand-logo center">模型转换器</a>
        <ul class="left" style="width: 100px;height: 100%;">
          <li>
            <a id="backHome" href="#">
              <i class="material-icons">arrow_back</i>
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="row card" style="margin-left: 10%;margin-right: 20%">
      <span class="card-title" style="display: block;margin: 0 auto;text-align: center;">转换流程</span>

      <div class="card-action">

        <div style="position: absolute; margin-top: -30px;margin-left: 2%;">
          <div class="fixed-action-btn click-to-toggle direction-bottom" style="position: absolute;display: inline-block;left: 10px;top: 30px;">
            <a class="btn-floating btn-middle teal pulse">
              <i class="large material-icons">open_in_browser</i>
            </a>
            <ul>
              <li><a class="btn-floating teal btn-middle"><i class="material-icons">attach_file</i></a></li>
              <li><a class="btn-floating blue darken-1"><i class="material-icons">developer_board</i></a></li>
            </ul>
          </div>
        </div>

        <div style="height: 100px;width: 120px;position: relative;" class="col s1 m1">
          <p style="position: absolute;bottom: 40px;">导入数据与模型</p>
        </div>

        <div style="height: 100px;width: 120px;" class="col s1 m1">
          <a class="btn-floating pulse" style="display: block;margin-left: 15%;">
            <i class="material-icons">poll</i>
          </a>
          <p>数据预处理</p>
        </div>
  
        <div style="height: 100px;width: 120px;" class="col s1 m1">
          <a class="btn-floating pulse" style="display: block;margin-left: 15%;">
            <i class="material-icons">build</i>
          </a>
          <p>参数调整校验</p>
        </div>
  
        <div style="height: 100px;width: 120px;" class="col s1 m1">
          <a class="btn-floating pulse" style="display: block;margin-left: 15%;">
            <i class="material-icons">autorenew</i>
          </a>
          <p>模型转换与仿真</p>
        </div>
      </div>
    </div>

    <div class="row z-depth-2">
      <!-- 显示加载数据的树形组件 -->
      <div class="col m2">
        <span class="card-title green-text text-darken-4"><font style="font-size: 20px;">数据预览</font></span>
          <div id="file_tree" class="waves-effect waves-teal z-depth-3 overflow:scroll"></div>
      </div>

      <!-- 数据可视化区域 -->
      <div class="col m6 z-depth-1">
        <!-- <img src="./resources/img_1.jpg" style="width: 100px;height: 100px; padding: 1px;">
        <img src="./resources/img_3.jpg" style="width: 100px;height: 100px; padding: 1px;">
        <img src="./resources/img_5.jpg" style="width: 100px;height: 100px; padding: 1px;">
        <img src="./resources/img_7.jpg" style="width: 100px;height: 100px; padding: 1px;"> -->
        <div id="img_carousel" class="carousel" style="height: 300px; width: 400px;">
          <a class="carousel-item" href="#one!"><img src="./resources/img_1.jpg"></a>
          <a class="carousel-item" href="#two!"><img src="./resources/img_2.jpg"></a>
          <a class="carousel-item" href="#three!"><img src="./resources/img_3.jpg"></a>
          <a class="carousel-item" href="#four!"><img src="./resources/img_5.jpg"></a>
          <a class="carousel-item" href="#five!"><img src="./resources/img_7.jpg"></a>
        </div>
        <div id="histgram" style="width: 400px; height: 300px;margin-top: 30px;"></div>
        <div id="dist_pie" style="width: 400px;height: 300px; margin-top: 30px;"></div>
        <div id="data_heatmap" style="width: 400px; height: 300px; margin-top: 30px;"></div>
      </div>

      <!--模型可视化区域-->
      <div class="col m4 z-depth-1">
        <div id="sankey" style="width: 400px; height: 300px;margin-top: 30px;"></div>
      </div>
    </div>

    <!-- 日志输出区 -->
    <div class="row z-depth-0">
      <div class="card col offset-m1 z-depth-0" style="width: 80%;">
        <span class="card-title">日志输出</span>
      </div>
    </div>
    <div class="row">
      <!--日志功能区-->
      <div class="col m1 z-depth-1 offset-m1" style="width: 3%;">
          <i class="small material-icons z-depth-2 waves-effect waves-red">file_download</i>
          <i class="small material-icons z-depth-2 waves-effect waves-red" style="margin-top: 30px;">delete</i>
      </div>
      <!-- 输出区 -->
      <div class="col m10 z-depth-1" style="width: 80%;height: 400px;overflow: auto;">
        <pre>
          /home/ahundt/.local/lib/python2.7/site-packages/h5py/__init__.py:36: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.
  from ._conv import register_converters as _register_converters
Using TensorFlow backend.
2018-02-24 17:57:24.388515: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1105] Found device 0 with properties: 
name: GeForce GTX TITAN X major: 5 minor: 2 memoryClockRate(GHz): 1.076
pciBusID: 0000:02:00.0
totalMemory: 11.92GiB freeMemory: 9.14GiB

logs: {'loss': 0.4783020753239531, 'val_binary_accuracy': 0.8544542032622334, 'val_mean_pred': 0.5765384233508778, 'mean_true': 0.6366707616707616, 'binary_accuracy': 0.7731879606879607, 'test_binary_accuracy': 0.793584379358438, 'test_mean_true': 0.603905160390516, 'test_loss': 0.40996293260487293, 'test_mean_pred': 0.5342399459001004, 'val_loss': 0.36071502117421406, 'mean_pred': 0.6342599527402357, 'val_mean_true': 0.6700125470514429}

Epoch 00001: val_binary_accuracy improved from -inf to 0.85445, saving model to ./logs_cornell/2018-02-24-17-57-25_deletme_finetuningtest-vgg_dense_model-dataset_cornell_grasping-grasp_success/2018-02-24-17-57-25_deletme_finetuningtest-vgg_dense_model-dataset_cornell_grasping-grasp_success-epoch-001-val_loss-0.361-val_binary_accuracy-0.854.h5
Training:  50%|████████████████████████████████████████████████████████████████████████████████████▌                                                                                    | 1/2 [01:10<01:10, 70.90s/it]
Epoch: 0 - loss: 0.478, binary_accuracy: 0.773, mean_pred: 0.634, mean_true: 0.637, val_loss: 0.361, val_binary_accuracy: 0.854, val_mean_pred: 0.577, val_mean_true: 0.670: 100%|██| 407/407 [01:10<00:00,  6.43s/it]
epoch:0 self.epoch: 1 lr: 0.01 self.learning_rate: 0.0001 float(K.get_value(self.model.optimizer.lr)): 0.00999999977648 what is going on?0




epoch:0 self.epoch: 1 lr: 0.01 self.learning_rate: 0.0001 float(K.get_value(self.model.optimizer.lr)): 9.99999974738e-05 what is going on?1



logs: {'loss': 0.3740986755314564, 'val_binary_accuracy': 0.8569636135508155, 'val_mean_pred': 0.6045755832911781, 'mean_true': 0.6362100737100738, 'binary_accuracy': 0.8356879606879607, 'test_binary_accuracy': 0.8131101813110181, 'lr': 0.01, 'test_mean_true': 0.606694560669456, 'test_loss': 0.3948480336364447, 'test_mean_pred': 0.5687255830441652, 'val_loss': 0.3517344869665072, 'mean_pred': 0.6220840345290135, 'val_mean_true': 0.6813048933500627}

Epoch 00002: val_binary_accuracy improved from 0.85445 to 0.85696, saving model to ./logs_cornell/2018-02-24-17-57-25_deletme_finetuningtest-vgg_dense_model-dataset_cornell_grasping-grasp_success/2018-02-24-17-57-25_deletme_finetuningtest-vgg_dense_model-dataset_cornell_grasping-grasp_success-epoch-002-val_loss-0.352-val_binary_accuracy-0.857.h5
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2/2 [02:12<00:00, 68.00s/it]
Epoch: 1 - loss: 0.374, binary_accuracy: 0.836, mean_pred: 0.622, mean_true: 0.636, val_loss: 0.352, val_binary_accuracy: 0.857, val_mean_pred: 0.605, val_mean_true: 0.681: 100%|██| 407/407 [01:01<00:00,  6.05s/it]
--------------------------------------------------------
Epoch 00002 Fine tuning initialized with a new learning rate of 0.0001.


epoch:1 self.epoch: 1 lr: 1e-04 self.learning_rate: 0.0001 float(K.get_value(self.model.optimizer.lr)): 9.99999974738e-05 what is going on?0




epoch:1 self.epoch: 1 lr: 1e-04 self.learning_rate: 0.0001 float(K.get_value(self.model.optimizer.lr)): 9.99999974738e-05 what is going on?1



val_loss
Writing logs for models, accuracy and tensorboard in ./logs_cornell/2018-02-24-17-59-40_deletme_finetuningtest-vgg_dense_model-dataset_cornell_grasping-grasp_success
Training:   0%|                                                                                                                                                                                 | 0/2 [00:00<?, ?it/s]2018-02-24 17:59:41.896400: I 

logs: {'loss': 0.4810578681034304, 'val_binary_accuracy': 0.8444165621079046, 'val_mean_pred': 0.6077896220565141, 'mean_true': 0.6355958230958231, 'binary_accuracy': 0.7681203931203932, 'test_binary_accuracy': 0.8158995815899581, 'test_mean_true': 0.6150627615062761, 'test_loss': 0.4176696949541657, 'test_mean_pred': 0.5816565619540015, 'val_loss': 0.3597393203379208, 'mean_pred': 0.6361474243223814, 'val_mean_true': 0.671267252195734}

Epoch 00001: val_binary_accuracy improved from -inf to 0.84442, saving model to ./logs_cornell/2018-02-24-17-59-40_deletme_finetuningtest-vgg_dense_model-dataset_cornell_grasping-grasp_success/2018-02-24-17-59-40_deletme_finetuningtest-vgg_dense_model-dataset_cornell_grasping-grasp_success-epoch-001-val_loss-0.360-val_binary_accuracy-0.844.h5
Training:  50%|████████████████████████████████████████████████████████████████████████████████████▌                                                                                    | 1/2 [01:06<01:06, 66.19s/it]
Epoch: 0 - loss: 0.481, binary_accuracy: 0.768, mean_pred: 0.636, mean_true: 0.636, val_loss: 0.360, val_binary_accuracy: 0.844, val_mean_pred: 0.608, val_mean_true: 0.671: 100%|██| 407/407 [01:06<00:00,  6.26s/it]
epoch:0 self.epoch: 1 lr: 0.01 self.learning_rate: 0.0001 float(K.get_value(self.model.optimizer.lr)): 0.00999999977648 what is going on?0




epoch:0 self.epoch: 1 lr: 0.01 self.learning_rate: 0.0001 float(K.get_value(self.model.optimizer.lr)): 9.99999974738e-05 what is going on?1



logs: {'loss': 0.3773377069091328, 'val_binary_accuracy': 0.8619824341279799, 'val_mean_pred': 0.6283095117490107, 'mean_true': 0.6380528255528255, 'binary_accuracy': 0.8312346437346437, 'test_binary_accuracy': 0.8200836820083682, 'lr': 0.01, 'test_mean_true': 0.596931659693166, 'test_loss': 0.4088241641346048, 'test_mean_pred': 0.5962408034058192, 'val_loss': 0.3422797008504018, 'mean_pred': 0.6235201416642425, 'val_mean_true': 0.6775407779171895}

Epoch 00002: val_binary_accuracy improved from 0.84442 to 0.86198, saving model to ./logs_cornell/2018-02-24-17-59-40_deletme_finetuningtest-vgg_dense_model-dataset_cornell_grasping-grasp_success/2018-02-24-17-59-40_deletme_finetuningtest-vgg_dense_model-dataset_cornell_grasping-grasp_success-epoch-002-val_loss-0.342-val_binary_accuracy-0.862.h5
Training: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2/2 [02:07<00:00, 64.76s/it]
Epoch: 1 - loss: 0.377, binary_accuracy: 0.831, mean_pred: 0.624, mean_true: 0.638, val_loss: 0.342, val_binary_accuracy: 0.862, val_mean_pred: 0.628, val_mean_true: 0.678: 100%|██| 407/407 [01:01<00:00,  6.12s/it]
--------------------------------------------------------
Epoch 00002 Fine tuning initialized with a new learning rate of 0.0001.


epoch:1 self.epoch: 1 lr: 1e-04 self.learning_rate: 0.0001 float(K.get_value(self.model.optimizer.lr)): 9.99999974738e-05 what is going on?0




epoch:1 self.epoch: 1 lr: 1e-04 self.learning_rate: 0.0001 float(K.get_value(self.model.optimizer.lr)): 9.99999974738e-05 what is going on?1

        </pre>
      </div>
    </div>
  </body>
  <style>
    @font-face {
      font-family: 'Material Icons';
      font-style: normal;
      font-weight: 400;
      src: local('Material Icons'), local('MaterialIcons-Regular'), url(https://fonts.gstatic.com/s/materialicons/v7/2fcrYFNaTjcS6g4U3t-Y5ZjZjT5FdEJ140U2DJYC3mY.woff2) format('woff2');
    }
  
    .material-icons {
      font-family: 'Material Icons';
      font-weight: normal;
      font-style: normal;
      font-size: 24px;
      line-height: 1;
      text-transform: none;
      display: inline-block;
      -webkit-font-feature-settings: 'liga';
      -webkit-font-smoothing: antialiased;
    }
  </style>
  <link rel="stylesheet" href="./node_modules/materialize-css/dist/css/materialize.min.css">
  <link rel="stylesheet" href="./node_modules/layui-src/dist/css/layui.css">
  <!-- You can also require other files to run in this process -->
  <script src="./node_modules/materialize-css/dist/js/materialize.min.js"></script>
  <script src="./node_modules/layui-src/dist/layui.js"></script>
  <script src="./node_modules/echarts/dist/echarts.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var elems = document.querySelectorAll('.fixed-action-btn');
      var instances = M.FloatingActionButton.init(elems, {"hoverEnabled":false});

      var carouselDiv = document.getElementById("img_carousel");
      var carouselInst = M.Carousel.init(carouselDiv,{});
    });

    layui.use('tree', function(){
    var tree = layui.tree;
    var treeData = new Array();
    for(var i=0;i<10;++i){
      var childData = new Object();
      childData.title = "数字"+i;
      childData.children = new Array();
      for(var j=0;j<5;++j){
        childData.children.push({title:"img_"+i+""+j+".jpg"});
      }
      treeData.push(childData);
    }
    console.log(treeData);
   
    //渲染
    var treeInst = tree.render({
      elem:"#file_tree",
      data:treeData,
      click: function(obj){
        console.log("点击数据:"+obj.data.title);
      }
    });
  });

    // 图片直方图绘制
    var echartHistgram = echarts.init(document.getElementById("histgram"));
    // 指定图表的配置项和数据
    var option = {
      title: {
          text: '像素灰度直方图'
      },
      tooltip: {},
      legend: {
          data:['累计个数']
      },
      xAxis: {
          data: ["0~41","42~83","84~125","126~167","168~209","201~255"],
          axisLabel:{
            rotate: 30,
            interval: 0
          }
      },
      yAxis: {},
      series: [{
          name: '像素累计',
          type: 'bar',
          data: [5, 20, 36, 10, 10, 20]
      }]
    };
    echartHistgram.setOption(option);
    // 数据类别分布饼图
    var echartDistPie = echarts.init(document.getElementById("dist_pie"));
    option = {
          title: {
              text: '数据分布',
              left: 'center',
              top: 20,
              textStyle: {
                  color: '#34495E'
              }
          },

          tooltip: {
              trigger: 'item',
              formatter: '{a} <br/>{b} : {c} ({d}%)'
          },

          visualMap: {
              show: false,
              min: 80,
              max: 600,
              inRange: {
                  colorLightness: [0, 1]
              }
          },
          series: [
              {
                  name: '数据占比',
                  type: 'pie',
                  radius: '55%',
                  center: ['50%', '50%'],
                  data: [
                      {value: 335, name: '类别1'},
                      {value: 310, name: '类别2'},
                      {value: 274, name: '类别3'},
                      {value: 235, name: '类别4'},
                      {value: 400, name: '类别5'}
                  ].sort(function (a, b) { return a.value - b.value; }),
                  roseType: 'radius',
                  label: {
                      color: '#34495E'
                  },
                  labelLine: {
                      lineStyle: {
                          color: '#34495E'
                      },
                      smooth: 0.2,
                      length: 10,
                      length2: 20
                  },
                  itemStyle: {
                      color: '#c23531',
                      shadowBlur: 200,
                      shadowColor: 'rgba(0, 0, 0, 0.5)'
                  },

                  animationType: 'scale',
                  animationEasing: 'elasticOut',
                  animationDelay: function (idx) {
                      return Math.random() * 200;
                  }
              }
          ]
    };
    echartDistPie.setOption(option);
    // 数据热力图
    var echartHeatMap = echarts.init(document.getElementById("data_heatmap"));
    var xAxis = ['0','1','2','3','4','5','6','7','8','9'];
    var yAxis = ['0','1','2','3','4','5','6','7','8','9'];
    var data=[[0, 0, 48], [0, 1, 51], [0, 2, 95], [0, 3, 21], [0, 4, 97], [0, 5, 15], [0, 6, 41], [0, 7,
 82], [0, 8, 40], [0, 9, 31], [1, 0, 11], [1, 1, 90], [1, 2, 52], [1, 3, 15], [1, 4, 71], [
1, 5, 14], [1, 6, 58], [1, 7, 30], [1, 8, 29], [1, 9, 31], [2, 0, 21], [2, 1, 49], [2, 2, 2
], [2, 3, 8], [2, 4, 19], [2, 5, 17], [2, 6, 53], [2, 7, 35], [2, 8, 93], [2, 9, 29], [3,
0, 23], [3, 1, 16], [3, 2, 72], [3, 3, 57], [3, 4, 50], [3, 5, 38], [3, 6, 48], [3, 7, 39],
 [3, 8, 94], [3, 9, 72], [4, 0, 59], [4, 1, 14], [4, 2, 78], [4, 3, 31], [4, 4, 93], [4, 5,
 27], [4, 6, 23], [4, 7, 27], [4, 8, 85], [4, 9, 42], [5, 0, 23], [5, 1, 73], [5, 2, 70], [
5, 3, 31], [5, 4, 88], [5, 5, 69], [5, 6, 98], [5, 7, 97], [5, 8, 22], [5, 9, 3], [6, 0, 63
], [6, 1, 52], [6, 2, 57], [6, 3, 30], [6, 4, 42], [6, 5, 83], [6, 6, 40], [6, 7, 39], [6,
8, 93], [6, 9, 35], [7, 0, 52], [7, 1, 46], [7, 2, 84], [7, 3, 99], [7, 4, 68], [7, 5, 41],
 [7, 6, 3], [7, 7, 41], [7, 8, 99], [7, 9, 97], [8, 0, 81], [8, 1, 41], [8, 2, 13], [8, 3,
33], [8, 4, 36], [8, 5, 37], [8, 6, 96], [8, 7, 92], [8, 8, 34], [8, 9, 5], [9, 0, 18], [9,
 1, 81], [9, 2, 59], [9, 3, 72], [9, 4, 54], [9, 5, 96], [9, 6, 73], [9, 7, 77], [9, 8, 79]
, [9, 9, 61]];

  data = data.map(function (item) {
      return [item[1], item[0], item[2] || '-'];
  });

  option = {
    title: {
              text: '热力图',
              left: 'center',
              top: 0,
              textStyle: {
                  color: '#ccc'
              }
      },
      tooltip: {
          position: 'top'
      },
      animation: false,
      grid: {
          height: '50%',
          top: '10%'
      },
      xAxis: {
          type: 'category',
          data: xAxis,
          splitArea: {
              show: true
          }
      },
      yAxis: {
          type: 'category',
          data: yAxis,
          splitArea: {
              show: true
          }
      },
      visualMap: {
          min: 0,
          max: 100,
          calculable: true,
          orient: 'horizontal',
          left: 'center',
          bottom: '15%'
      },
      series: [{
          name: 'Punch Card',
          type: 'heatmap',
          data: data,
          label: {
              show: true
          },
          emphasis: {
              itemStyle: {
                  shadowBlur: 10,
                  shadowColor: 'rgba(0, 0, 0, 0.5)'
              }
          }
      }]
  };
    echartHeatMap.setOption(option);

    // 模型桑基图
    var echartSankey = echarts.init(document.getElementById("sankey"));
    var nodeList = [
      {"name":"Input Layer"},
      {"name":"Dense Layer 1024"},
      {"name":"Dense Layer 512"},
      {"name":"Dense Layer 256"},
      {"name":"Dense Layer 32"},
      {"name":"Dense Layer 10"}
    ];

    var linkList = [
      {"source":"Input Layer","target":"Dense Layer 1024", value:4560},
      {"source":"Dense Layer 1024","target":"Dense Layer 512", value:2345},
      {"source":"Dense Layer 512","target":"Dense Layer 256", value:1245},
      {"source":"Dense Layer 256","target":"Dense Layer 32", value:978},
      {"source":"Dense Layer 32","target":"Dense Layer 10", value:900},
    ];
    option = {
        title: {
            text: ''
        },
        tooltip: {
            trigger: 'item',
            triggerOn: 'mousemove'
        },
        series: [
            {
                type: 'sankey',
                data: nodeList,
                links: linkList,
                focusNodeAdjacency: 'allEdges',
                itemStyle: {
                    borderWidth: 1,
                    borderColor: '#aaa'
                },
                lineStyle: {
                    color: 'source',
                    curveness: 0.5
                }
            }
        ]
    };
    echartSankey.setOption(option);

    require("./renderer_convertor.js");
  </script>
</html>
