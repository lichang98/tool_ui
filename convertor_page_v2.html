<!DOCTYPE html>
<html style="height: 100%;width: 100%;">

<head>
  <meta charset="UTF-8">
  <title>Darwin IDE</title>
</head>
<body class="dark-mode" style="height: 100%;width: 100%;overflow: hidden;">

  <div style="-webkit-app-region: drag;-webkit-user-select: none;width: 100%;overflow: hidden;height: 40px;">
    <div style="display: inline-block;margin-bottom: 25px;overflow: hidden;top: 0px;">
      <img src="./resources/favicon.ico" style="width: 15px;height: 15px;" alt="">
    </div>
    <div style="overflow: hidden;margin-bottom: 20px;-webkit-app-region: no-drag;display: inline-block;margin-left: 20px;font-size: 10px;">
      <ul style="height: 10px;">
        <li style="float: left;" id="menu_proj" class="dropdown-trigger" data-target="menu_proj_dropdown">Project</li>
        <li style="float: left;margin-left: 10px;" id="data_mange" class="dropdown-trigger" data-target="data_dropdown">Data</li>
        <li style="float: left;margin-left: 10px;" id="model_manage" class="dropdown-trigger" data-target="model_dropdown">Model</li>
        <li style="float: left;margin-left: 10px;">View</li>
        <li style="float: left;margin-left: 10px;">Go</li>
        <li style="float: left;margin-left: 10px;">Run</li>
      </ul>
      <!--菜单栏下拉列表-->
        <ul id="menu_proj_dropdown" class="dropdown-content">
          <li id="menu_proj_new" class="dark-mode">新建工程</li>
          <li id="menu_proj_open" class="dark-mode">打开工程</li>
          <li id="menu_proj_save" class="dark-mode">保存工程</li>
        </ul>
        <!--数据菜单-->
        <ul id="data_dropdown" class="dropdown-content">
          <li id="data_import" class="dark-mode">导入数据</li>
          <li id="data_vis" class="dark-mode">可视化数据</li>
        </ul>
        <!--模型菜单-->
        <ul id="model_dropdown" class="dropdown-content">
          <li id="model_import" class="dark-mode">导入模型</li>
          <li id="model_vis" class="dark-mode">可视化模型</li>
        </ul>
    </div>
    <div style="height: 10px;line-height: 10px;display: inline-block;margin-bottom: 35px;margin-left: calc(50vw - 200px);overflow: hidden;font-size: 10px;">
      模型转换器
    </div>
    <div style="-webkit-app-region: no-drag;display: inline-block;float: right;">
        <!-- <img src="./resources/min_window.png" style="width: 30px;height: 25px;display: inline-block;margin-right: 10px;" id="main_window_minimize" alt=""> -->
        <div style="width: 30px;height: 25px;display: inline-block;margin-right: 10px;" id="main_window_minimize"><i class="material-icons">remove</i></div>
        <!-- <img src="./resources/close_window.png" style="width: 30px;height: 25px;display: inline-block;margin-right: 10px;" id="main_window_close" alt=""> -->
        <div style="width: 30px;height: 25px;display: inline-block;margin-right: 10px;" id="main_window_close"><i class="material-icons">close</i></div>
    </div>
  </div>

    <!-- 顶部标题栏 -->
    <nav id="menu_nav" class="dark-mode" style="height: 80px;">
      <div id="menu_bar" class="nav-wrapper gray-text text-darken-4" style="height: 80px;">
        <!-- <a href="#!" class="right" style="margin-right: 0;">
          <img src="./resources/convertor_log.png" style="width: 105px;height: 100%;margin-left: 0;"></img>
        </a>
        <a href="#!" class="brand-logo center">模型转换器</a> -->
        <a id="hide_menu" class="right" style="margin-right: 0;margin-bottom: 0;">
          <!-- <img id="hide_menu_img" src="./resources/hide.png" style="width: 15px;height: 10px; margin-right: 10px;vertical-align: bottom;"/> -->
          <div id="hide_menu_img" style="width: 15px;height: 10px; margin-right: 10px;vertical-align: bottom;display: inline-block;"><i class="material-icons" style="width: 15px;height: 10px;">visibility_off</i></div>
          <!-- <img id="show_menu_img" src="./resources/visible.png" style="width: 15px;height: 10px; margin-right: 10px;display: none;"/> -->
          <div id="show_menu_img" style="width: 15px;height: 10px; margin-right: 10px;display: none;"><i class="material-icons">visibility</i></div>
        </a>
        <ul>
          <!-- <li>
            <a id="backHome" href="#">
              <i class="material-icons">arrow_back</i>
            </a>
          </li> -->
          <!-- <li id="menu_proj" class="dropdown-trigger" data-target="menu_proj_dropdown" style="margin-left: 10px;"> -->
              <!-- <img id="menu_proj_img" src="./resources/menu_proj.png" style="height: 30px;display: block;margin-top: 10px;margin-left: 10px;"></img> -->
              <!-- <div id="menu_proj_img"  style="height: 30px;display: block;margin-top: 10px;margin-left: 10px;"><i class="material-icons">class</i></div>
              <span style="font-size: 10px;">工程</span>
              <ul id="menu_proj_dropdown" class="dropdown-content">
                <li id="menu_proj_new" class="dark-mode">新建工程</li>
                <li id="menu_proj_open" class="dark-mode">打开工程</li>
              </ul> -->
          <!-- </li> -->
          <!-- <li id="data_mange" class="dropdown-trigger" data-target="data_dropdown" style="margin-left: 10px;"> -->
              <!-- <img id="menu_data_img" src="./resources/menu_data.png" style="height: 30px;display: block;margin-top: 10px;margin-left: 10px;"></img> -->
              <!-- <div id="menu_data_img"  style="height: 30px;display: block;margin-top: 10px;margin-left: 10px;"><i class="material-icons">description</i></div>
              <span style="font-size: 10px;">数据</span>
              <ul id="data_dropdown" class="dropdown-content">
                <li id="data_import" class="dark-mode">导入数据</li>
                <li id="data_vis" class="dark-mode">可视化数据</li>
                <li class="divider" tabindex="-1"></li>
              </ul> -->
          <!-- </li> -->
          <li style="margin-left: 10px;">
              <!-- <img id="menu_model_img" src="./resources/menu_model.png"style="height: 30px;display: block;margin-top: 10px;margin-left: 10px;"/> -->
              <div id="menu_model_img"  style="height: 30px;display: block;margin-top: 10px;margin-left: 10px;"><i class="material-icons">autorenew</i></div>
              <span style="font-size: 10px;">转换</span>
          </li>
          <li style="margin-left: 10px;">
            <!-- <img id="menu_run_img" src="./resources/menu_run.png"style="height: 30px;display: block;margin-top: 10px;margin-left: 10px;"/> -->
            <div id="menu_run_img"  style="height: 30px;display: block;margin-top: 10px;margin-left: 10px;"><i class="material-icons">fast_forward</i></div>
            <span style="font-size: 10px;">运行</span>
          </li>
        </ul>
      </div>
    </nav>

    <!--标签页-->
    <ul id="tabs" class="nav nav-tabs" style="margin-left:200px;margin-right: 220px;">
      <li id="tab_title_data_vis" class="active" style="display: none;">
        <a id="tab_title_data_vis_link" href="#data_vis_tab" data-toggle="tab"><span class="new badge grey darken-2" data-badge-caption="">数据可视化<i id="close_data_vis_tab" class="material-icons tiny">close</i></span></a>
      </li>
      <li id="tab_title_model_vis" style="display: none;">
        <a id="tab_title_model_vis_link" href="#model_vis_tab" data-toggle="tab"><span class="new badge grey darken-2" data-badge-caption="">模型可视化<i id="close_model_vis_tab" class="material-icons tiny">close</i></span></a>
      </li>
    </ul>

    <!-- 左侧导航栏 主面板与配置面板 -->
    <div class="row" style="height: calc(100vh - 140px);width: 100%;">
      <div class="col-sm-2 z-depth-2">
        <div class="gray-text" style="text-align: center;">导航栏</div>
        <div id="tree_container" class="z-depth-1" style="overflow: auto;"></div>
      </div>

      <div id="loader_tip" class="preloader-wrapper big active" style="position: absolute;margin-left: 600px;margin-top: 100px;display: none;">
        <div class="spinner-layer spinner-green-only">
          <div class="circle-clipper left">
            <div class="circle"></div>
          </div><div class="gap-patch">
            <div class="circle"></div>
          </div><div class="circle-clipper right">
            <div class="circle"></div>
          </div>
        </div>
      </div>

      <div class="col-sm-10" style="height: calc(100vh - 340px);">
        <div class="row" style="width: 105%;height: 100%;">
          <!--左侧主面板-->
          <div class="col-sm-10 row" style="width: 100%;float: right;right: -30px;">
            <div id="main_panel" class="tab-content" style="display: inline-block;width: 98%;height: 100%;">
              <!--数据可视化tab页-->
              <div id="data_vis_tab" class="tab-pane">
                <div class="col m3">
                  <!-- 数据基本信息表格 -->
                  <table id="data_general_table" style="display: none;">
                    <caption class="white-text" style="caption-side: top;text-align: center;">导入数据统计</caption>
                    <tr>
                      <td>总数据大小</td>
                      <td id="total_data_amount"></td>
                    </tr>
                    <tr>
                      <td>测试数据量</td>
                      <td id="test_data_amount"></td>
                    </tr>
                    <tr>
                      <td>验证数据量</td>
                      <td id="val_data_amount"></td>
                    </tr>
                  </table>
                </div>
                <div class="col m5">
                  <div id="pie_chart_container" style="width: 440px; height: 360px;">
                  </div>
                </div>
                <div id="sample_data_div" class="col m3" style="display: none;">
                  <div style="text-align: center;font-weight: bold;">
                    样例数据
                  </div>
                  <img id="sample_img" src="./inner_scripts/sample.png" style="width: 50px;height: 50px;display: none;margin-left: 60px;margin-top: 40px;">
                  <div id="bar_chart_histgram" style="width: 300px;height: 300px;margin-left: 70px;"></div>
                </div>
              </div>
              <!--模型可视化tab页-->
              <div id="model_vis_tab" class="tab-pane">
                <div class="col m3">
                  <!-- 数据基本信息表格 -->
                  <table id="model_general_table" style="display: none;">
                    <caption class="white-text" style="caption-side: top;text-align: center;width: 160px;">ANN模型基本信息</caption>
                    <tr>
                      <td>总层数</td>
                      <td id="model_total_layers"></td>
                    </tr>
                    <tr>
                      <td>总参数量</td>
                      <td id="model_total_param"></td>
                    </tr>
                    <tr>
                      <td>unit数量</td>
                      <td id="model_total_units"></td>
                    </tr>
                  </table>
                </div>
              </div>
              <!--全屏切换-->
              <div id="full_screen_toggle" style="float: right;right: 5px;top: 5px;">
                <!-- <img src="./resources/full_screen.png" style="width: 30px;height: 30px;margin-right: 20px;"> -->
                <div style="width: 30px;height: 30px;margin-right: 20px;"><i class="material-icons">pages</i></div>
              </div>
            </div>
          </div>
          <!--右侧配置面板-->
          <div id="config_panel" class="col-sm-2 z-depth-1">
            <div class="row">
              <div class="z-depth-1" style="text-align: center;margin-left: 0px;">配置面板</div>
              <div id="toggle_config_panel_hide" class="col-sm-4">
                <!-- <img src="./resources/toggle_expand.png" style="width: 20px;height: 20px;float: right;"> -->
                <div style="width: 20px;height: 20px;float: right;"><i class="material-icons">swap_horiz</i></div>
              </div>
            </div>
          </div>
          <div id="toggle_config_panel_show" style="width: 20px;position: absolute;float:right; right: 5px;display: none;">
            <div class="row">
              <!-- <img id="hide_config_panel_img" src="./resources/toggle_expand.png" style="width: 20px;height: 20px;float: right;"> -->
              <div id="hide_config_panel_img" style="width: 20px;height: 20px;float: right;"><i class="material-icons">swap_horiz</i></div>
            </div>
          </div>
        </div>
        <div class="row" style="width: 112%;">
          <!-- 日志输出面板 -->
          <div class="col-sm-11">
            <div id="log_output_panel" class="row z-depth-2" style="width: 100%;display: block;margin-left: 5px;">
              <div class="col-sm-11" style="margin-right: 100px;">
                <ul style="height: 15px;margin-right: 200px;">
                  <li style="float: left;font-size: 10px;">PROBLEMS</li>
                  <li style="float: left; margin-left: 10px;font-size: 10px;">OUTPUT</li>
                  <!-- <li id="toggle_output_panel" style="float: left; margin-left: 10px;"><i class="material-icons">save</i></li> -->
                </ul>
                <!-- <div class="com-sm-2  z-depth-2" style="height: 100%;">
                  <i class="material-icons">save</i>
                  <br/>
                  <i class="material-icons">delete</i>
                </div> -->
                <!-- 内容输出区 -->
                <div style="overflow: auto;height: 300px;">
                </div>
              </div>
            </div>
          </div>
          <div>
            <i id="toggle_output_panel" class="material-icons" style="float: right;right: 0px;margin-right: 0px;margin-top: 30px;">swap_vert</i>
          </div>
        </div>
      </div>
    </div>

    <!-- 编辑器界面 -->
    <!-- <div id="slide_editor" class="sidenav editor-sidenav resizable" style="width: 70%;background-color: #333;">
      <div style="width: 100%;height: 10%;">
        <div class="card-content white-text" style="text-align: center;">
          <span class="title">编辑器</span>
        </div>
        <div class="card-action">
          <a href="#">
            <i class="material-icons">file_upload</i>
          </a>
          <a style="width: 40px;"></a>
          <a href="#">
            <i class="material-icons">save</i>
          </a>
          <a style="width: 40px;"></a>
          <a href="#">
            <i class="material-icons">delete</i>
          </a>
        </div>
      </div>
      <div id="editor_container" style="width: 100%; height: 90%;"></div>
    </div> -->


    <!-- 交互主面板 -->
    <!-- <div class="row" style="width: 100%; height: 100%; margin: 0;"> -->

    <!-- </div> -->
    <!--日志输出栏-->
    <!-- <div class="row" id="toggle_output_panel" style="float: right;right: 10px;">
      <div class="col m1">
        <img src="./resources/hide_panel.png" style="width: 30px;height: 30px;">
      </div>
    </div>
    <div id="log_output_panel" class="row z-depth-2" style="position: fixed;bottom: -10px;width: 98%;height: 160px;display: block;margin-left: 210px;">
      <div class="col m1  z-depth-2" style="height: 100%;">
        <i class="material-icons">save</i>
        <br/>
        <i class="material-icons">delete</i>
      </div>
      <div class="col m10" style="overflow: auto;height: 300px;">
      </div>
    </div> -->
</body>
<style>

.editor-sidenav{
  background-color: #333;
}

body {
  padding: 25px;
  background-color: black;
  color: white;
  font-size: 25px;
}

.dark-mode {
  background-color: rgb(61, 57, 57);
  color: white;
}
  @font-face {
    font-family: 'Material Icons';
    font-style: normal;
    font-weight: 400;
    src: local('Material Icons'), local('MaterialIcons-Regular'), url(https://fonts.gstatic.com/s/materialicons/v7/2fcrYFNaTjcS6g4U3t-Y5ZjZjT5FdEJ140U2DJYC3mY.woff2) format('woff2');
  }

  .material-icons {
    font-family: 'Material Icons';
    font-weight: normal;
    font-style: normal;
    font-size: 24px;
    line-height: 1;
    text-transform: none;
    display: inline-block;
    -webkit-font-feature-settings: 'liga';
    -webkit-font-smoothing: antialiased;
  }

  .resizable {
    resize: both;
    overflow: scroll;
    border: 1px solid black;
  }
  .dropdown-content{
   width: max-content !important;
   height:auto !important;
}
</style>
<link rel="stylesheet" href="./node_modules/materialize-css/dist/css/materialize.css">
<link rel="stylesheet" href="./resources/js/treejs-master/treejs.css">
<link rel="stylesheet" href="./node_modules/monaco-editor/min/vs/editor/editor.main.css">
<link rel="stylesheet" href="./node_modules/xterm/css/xterm.css">
<link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">
<!-- You can also require other files to run in this process -->
<script>
  window.$ = window.jQuery = require("./node_modules/jquery/dist/jquery.js");
</script>
<script src="./resources/js/treejs-master/tree.js"></script>
<script src="./node_modules/xterm/lib/xterm.js"></script>
<script src="./node_modules/materialize-css/dist/js/materialize.js"></script>
<script src="./node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="./node_modules/echarts/dist/echarts.min.js"></script>
<!-- <script src="./node_modules/jquery/dist/jquery.js"></script> -->
<script>
  const {ipcRenderer} = require('electron');
  const fs = require("fs");
  const exec = require("child_process").exec;
  var path = require("path");

  var projFilePath = undefined;
  var tree_view = undefined;
  var data_file_paths = undefined; // 导入的数据文件路径列表
  var model_file_path = undefined; // 导入的模型文件路径

    document.addEventListener('DOMContentLoaded',function(){
      var menu_proj_dropdown = document.getElementById("menu_proj_dropdown");
      var data_dropdown = document.getElementById("data_dropdown");
      var model_dropdown = document.getElementById("model_dropdown");

      var elems = document.querySelectorAll('.dropdown-trigger');
      var instances = M.Dropdown.init(elems, {});

      menu_proj_dropdown.onmouseout = function(){
          // instances[0].close();
      }
      data_dropdown.onmouseout = function(){
        // instances[1].close();
      }
      model_dropdown.onmouseout = function(){
        // instances[2].close();
      }
      document.getElementById("hide_menu_img").onclick = function(){
        document.getElementById("menu_bar").style.height = "40px";
        document.getElementById("menu_nav").style.height = "40px";
        // document.getElementById("menu_proj_img").style.display="none";
        // document.getElementById("menu_data_img").style.display="none";
        document.getElementById("menu_model_img").style.display="none";
        document.getElementById("menu_run_img").style.display="none";

        // document.getElementById("hide_menu_img").style.marginRight="10px";
        // document.getElementById("hide_menu_img").style.verticalAlign="bottom";
        document.getElementById("show_menu_img").style.display = "inline-block";
        document.getElementById("hide_menu_img").style.display = "none";
      }

      document.getElementById("show_menu_img").onclick = function(){
        document.getElementById("menu_bar").style.height = "80px";
        document.getElementById("menu_nav").style.height = "80px";
        // document.getElementById("menu_proj_img").style.display="block";
        // document.getElementById("menu_data_img").style.display="block";
        document.getElementById("menu_model_img").style.display="block";
        document.getElementById("menu_run_img").style.display="block";

        document.getElementById("show_menu_img").style.display = "none";
        document.getElementById("hide_menu_img").style.display = "inline-block";
      }

      // 隐藏配置面板
      $("#toggle_config_panel_hide").on("click",()=>{
        document.getElementById("config_panel").style.display="none";
        document.getElementById("toggle_config_panel_show").style.display = "inline-block";
        document.getElementById("toggle_config_panel_show").style.float = "right";
        document.getElementById("toggle_config_panel_show").style.right = "-30px";
        document.getElementById("main_panel").setAttribute("class","col-sm-12");
        document.getElementById("main_panel").style.float = "right";
        document.getElementById("main_panel").style.right = "40px";
      });

      $("#hide_config_panel_img").on("click",()=>{
        // 重新显示
        document.getElementById("config_panel").style.display="inline-block";
        document.getElementById("toggle_config_panel_show").style.display = "none";
        document.getElementById("main_panel").setAttribute("class","col-sm-10");
        document.getElementById("main_panel").style.right = "-30px";
      });


      // 输入日志面板切换
      $("#toggle_output_panel").on("click",()=>{
        console.log("panel display is :"+document.getElementById("log_output_panel").style.display);
        if(document.getElementById("log_output_panel").style.display === "none"){
          document.getElementById("log_output_panel").style.display = "block";
          document.getElementById("toggle_output_panel").style.float="right";
          document.getElementById("toggle_output_panel").style.right="5px";
          document.getElementById("toggle_output_panel").style.position="relative";
          document.getElementById("toggle_output_panel").style.bottom="0px";
        }else{
          document.getElementById("log_output_panel").style.display = "none";
          document.getElementById("toggle_output_panel").style.float="right";
          document.getElementById("toggle_output_panel").style.position="fixed";
          document.getElementById("toggle_output_panel").style.bottom="5px";
        }
      });

      // 切换主面板全屏
      // <div id="main_panel" class="col-sm-10" style="height: 100%;width: 100%;float: right;right: -30px;">
      $("#full_screen_toggle").on("click",()=>{
        if(document.getElementById("main_panel").getAttribute("class") === ""){
          document.getElementById("main_panel").style.zIndex = "";
          document.getElementById("main_panel").style.width = "98%";
          document.getElementById("main_panel").style.height = "100%";
          document.getElementById("main_panel").style.position = "";
          document.getElementById("main_panel").style.top = "";
          document.getElementById("main_panel").style.left = "";
          document.getElementById("main_panel").style.background = "";
        }else{
          // 全屏状态
          document.getElementById("main_panel").style.zIndex = "100";
          document.getElementById("main_panel").style.width = "100%";
          document.getElementById("main_panel").style.height = "100%";
          document.getElementById("main_panel").style.position = "fixed";
          document.getElementById("main_panel").style.top = "0px";
          document.getElementById("main_panel").style.left = "0px"; 
          document.getElementById("main_panel").style.background = "#424242";
          document.getElementById("main_panel").setAttribute("class","");
        }
      });

      // 数据可视化
      $("#data_vis").on("click",function(){
        document.getElementById("tab_title_data_vis").style.display = "block";
        document.getElementById("tab_title_data_vis_link").click();
        document.getElementById("loader_tip").style.display = "block"; // 加载提示
        $("#model_vis_tab").hide();
        $("#data_vis_tab").show();
        // 运行py脚本
        console.log("curr path is :"+__dirname);
        var script_path = path.join(__dirname, "inner_scripts","data_analyze.py");
        var cmd_str = "python " + script_path + " "  + data_file_paths[0] + "  " + data_file_paths[1] + "  "+ data_file_paths[2];
        exec(cmd_str, function(err, stdout, stderr){
          if(err){
            console.log("get error while running script "+err);
          }else{
            console.log("script running finish.");
            fs.readFile(path.join(__dirname,"inner_scripts","data_info.json"), "utf-8",(err,data)=>{
              console.log("Read data info....");
              console.log("data is :"+data);
              data = JSON.parse(data);
              document.getElementById("sample_data_div").style.display="block";
              // 显示表格
              document.getElementById("data_general_table").style.display = "block";
              $("#total_data_amount").text(data.total_data_count);
              $("#test_data_amount").text(data.test_data_count);
              $("#val_data_amount").text(data.norm_data_count);
              data_classes = data.cls_counts;
              var cls_names=[];
              var cls_items=[];
              for(var i=0;i<data_classes.length;++i){
                cls_names.push(""+i);
                cls_items.push({"name":""+i, "value":data_classes[i]});
              }
              display_data_pie_chart(cls_names, cls_items);
              document.getElementById("sample_img").style.display="block";
              var hist_bin_names = data.hist_bin_names;
              var hist_bin_vals = data.hist_grams;
              console.log("hist bin names: "+hist_bin_names);
              console.log("hist bin vals:"+hist_bin_vals);
              display_hist_gram_chart(hist_bin_names, hist_bin_vals);
            });
          }
          document.getElementById("loader_tip").style.display = "none"; // 关闭加载提示
        });
      });

      // 数据可视化tab页关闭
      $("#close_data_vis_tab").on("click",function(){
        $("#data_vis_tab").hide();
        document.getElementById("tab_title_data_vis").style.display = "none";
      });

      // 模型可视化
      $("#model_vis").on("click",function(){
        document.getElementById("tab_title_model_vis").style.display = "block";
        document.getElementById("tab_title_model_vis_link").click();
        document.getElementById("loader_tip").style.display = "block"; // 加载提示
        $("#data_vis_tab").hide();
        $("#model_vis_tab").show();
        // 运行py脚本
        var script_path = path.join(__dirname, "inner_scripts","model_desc.py");
        var cmd_str = "python "+script_path+" "+model_file_path;
        console.log("start running script:"+script_path);
        exec(cmd_str, function(err, stdout, stderr){
          if(err){
            console.log("get error when running script "+err);
          }else{
            console.log("script running finish.");
            fs.readFile(path.join(__dirname,"inner_scripts","model_general_info.json"), "utf-8",(evt,data)=>{
              console.log("Read data is :"+data);
              data = JSON.parse(data);
              // 显示表格
              document.getElementById("model_general_table").style.display = "block";
              $("#model_total_layers").text(""+data.total_num_layers);
              $("#model_total_param").text(""+data.total_params);
              $("#model_total_units").text(""+data.total_units);
            });
          }
          document.getElementById("loader_tip").style.display = "none"; // 关闭加载提示
        });
      });

      // 模型可视化tab页关闭
      $("#close_model_vis_tab").on("click",function(){
        $("#model_vis_tab").hide();
        document.getElementById("tab_title_model_vis").style.display = "none";
      });

    });

    document.getElementById("main_window_minimize").addEventListener("click",()=>{
      ipcRenderer.send("main-window-minimize");
    });
    document.getElementById("main_window_close").addEventListener("click",()=>{
      ipcRenderer.send("main-window-close");
    });

    function display_data_pie_chart(cls_names, cls_items){
      var pie_chart_data = echarts.init(document.getElementById("pie_chart_container"));
        var option = {
              title: {
                  text: '数据总体分布',
                  left: 'center',
                  textStyle:{
                    color:"#FDFEFE"
                  }
              },
              tooltip: {
                  trigger: 'item',
                  formatter: '{a} <br/>{b} : {c} ({d}%)'
              },
              legend: {
                  orient: 'vertical',
                  left: 'left',
                  data: cls_names,
                  textStyle:{
                    color:"#FDFEFE"
                  }
                  // data: ['直接访问', '邮件营销', '联盟广告', '视频广告', '搜索引擎']
              },
              series: [
                  {
                      name: '类别占比',
                      type: 'pie',
                      radius: '55%',
                      center: ['50%', '60%'],
                      data: cls_items,
                      // data: [
                      //     {value: 335, name: '直接访问'},
                      //     {value: 310, name: '邮件营销'},
                      //     {value: 234, name: '联盟广告'},
                      //     {value: 135, name: '视频广告'},
                      //     {value: 1548, name: '搜索引擎'}
                      // ],
                      emphasis: {
                          itemStyle: {
                              shadowBlur: 10,
                              shadowOffsetX: 0,
                              shadowColor: 'rgba(0, 0, 0, 0.5)'
                          }
                      }
                  }
              ]
          };
          pie_chart_data.setOption(option);
    }


    function display_hist_gram_chart(labels, vals){
      var hist_gram_bar_chart = echarts.init(document.getElementById("bar_chart_histgram"));
      option = {
          xAxis: {
              type: 'category',
              data: labels,
              axisLabel:{
                rotate: 60
              }
              // data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
          },
          yAxis: {
              type: 'value'
          },
          series: [{
              // data: [120, 200, 150, 80, 70, 110, 130],
              data: vals,
              type: 'bar'
          }]
        };
        hist_gram_bar_chart.setOption(option);
    }
    // document.addEventListener('DOMContentLoaded', function() {
    //   var elem = document.querySelector('#slide-out');
    //   var instance = new M.Sidenav(elem,{"edge":"left"});
    //   var editor_elem = document.querySelector("#slide_editor");
    //   var editor_inst = new M.Sidenav(editor_elem);

    //   $("#hide_logoutput").on("click",function(){
    //     if($("#log_output_panel").css("height") === "0px"){
    //       $("#log_output_panel").css("height","160px")
    //     }else{
    //       $("#log_output_panel").css("height","0px")
    //     }
    //   });

    // });
    // const {ipcRenderer} = require('electron');
    // $("#backHome").on("click",function(){
    //   ipcRenderer.send("back_to_main_page");
    // });

		// (function () {
		// 	const path = require('path');
		// 	const amdLoader = require('./node_modules/monaco-editor/min/vs/loader.js');
		// 	const amdRequire = amdLoader.require;
		// 	const amdDefine = amdLoader.require.define;

		// 	function uriFromPath(_path) {
		// 		var pathName = path.resolve(_path).replace(/\\/g, '/');
		// 		if (pathName.length > 0 && pathName.charAt(0) !== '/') {
		// 			pathName = '/' + pathName;
		// 		}
		// 		return encodeURI('file://' + pathName);
		// 	}

		// 	amdRequire.config({
		// 		baseUrl: uriFromPath(path.join(__dirname, './node_modules/monaco-editor/min'))
		// 	});

		// 	// workaround monaco-css not understanding the environment
		// 	self.module = undefined;

		// 	amdRequire(['vs/editor/editor.main'], function () {
		// 		var editor = monaco.editor.create(document.getElementById('editor_container'), {
		// 			value: "",
		// 			language: 'javascript'
    //     });
    //     monaco.editor.setTheme('vs-dark');
		// 	});
    // })();

      // 添加左侧导航栏
    var root = new TreeNode("项目");
    var model_node = new TreeNode("模型");
    // var model_img_node = new TreeNode("图像分类模型");
    // var model_voice_node = new TreeNode("语音识别模型");
    
    var data_node = new TreeNode("数据");
    // var data_img_node = new TreeNode("图像分类数据");
    // var data_voice_node = new TreeNode("语音识别数据");

    root.addChild(model_node);
    root.addChild(data_node);
    model_node.addChild(new TreeNode("-"));
    model_node.setExpanded(false);
    data_node.addChild(new TreeNode("-"));
    data_node.setExpanded(false);
    // model_node.addChild(model_img_node);
    // model_node.addChild(model_voice_node);
    // model_img_node.addChild(new TreeNode("-"));
    // model_voice_node.addChild(new TreeNode("-"));
    // model_img_node.setExpanded(false);
    // model_voice_node.setExpanded(false);
    // data_node.addChild(data_img_node);
    // data_node.addChild(data_voice_node);
    // data_img_node.addChild(new TreeNode("-"));
    // data_voice_node.addChild(new TreeNode("-"));
    // data_img_node.setExpanded(false);
    // data_voice_node.setExpanded(false);

    tree_view = new TreeView(root, "#tree_container");

    $("#menu_proj_new").on("click",function(){
      ipcRenderer.send("new project");
      ipcRenderer.on("new project save path", (evt,args)=>{
        console.log("target path is ["+args+"]");
        projFilePath = args;
        fs.writeFile(args, "tmp data",function(err){
          console.log("write finished");
        });
      });
    });

    // 打开已有的项目文件
    $("#menu_proj_open").on("click",function(){
      ipcRenderer.send("open project");
      ipcRenderer.on("opened proj path",(evt,args)=>{
        console.log("proj file path is ["+args[0]+"]");
        fs.readFile(args[0], 'utf-8', (err, data)=>{
          if(err){
            return;
          }
          console.log("read file content is:"+data);
          // initialize tree view if necessary
          if(!tree_view){
            tree_view = new TreeView(root, '#tree_container');
          }

          // add data to side tree view explorer
          file_paths = JSON.parse(data).data_paths;
          data_file_paths = file_paths
          console.log("file paths: "+file_paths);
          data_node.removeChildPos(0);
          for(var i=0;i<file_paths.length;++i){
            data_node.addChild(new TreeNode(file_paths[i]));
          }
          // 加载模型文件
          modelPath = JSON.parse(data).model_path;
          model_file_path = modelPath;
          console.log("model file path :"+model_file_path);
          model_node.removeChildPos(0);
          model_node.addChild(new TreeNode(model_file_path));
        });
      });
    });

    // 保存工程
    $("#menu_proj_save").on("click",function(){
      proj_info = {"data_paths":data_file_paths,"model_path":model_file_path}
      fs.writeFile(projFilePath, JSON.stringify(proj_info), function(err){
      });
    });

    $("#data_import").on("click",function(){
      console.log("导入数据");
      ipcRenderer.send("import data");
      ipcRenderer.on("imported data paths",(evt,args)=>{
        console.log("imported data paths: "+args);
        filePaths = JSON.parse(args);
        data_file_paths = filePaths;
        console.log("prepare to add "+filePaths.length+" data packs");
        // add data file to tree view
        data_node.removeChildPos(0);
        for(var i=0;i<filePaths.length;++i){
          data_node.addChild(new TreeNode(filePaths[i]));
        }
        // fs.writeFile(projFilePath, JSON.stringify({"data_paths":filePaths}), function(err){
        // });
      });

    });

    // 模型导入
    $("#model_import").on("click",function(){
      console.log("导入模型");
      ipcRenderer.send("import model");
      ipcRenderer.on("imported model path",(evt, args)=>{
        console.log("imported model path: "+args);
        modelFilePath = JSON.parse(args);
        model_file_path = modelFilePath;
        console.log("prepare to load model: " + modelFilePath);
        model_node.removeChildPos(0);
        model_node.addChild(new TreeNode(model_file_path));
      });
    });

    // var root = new TreeNode("root");
    // var n1 = new TreeNode("1");
    // var n11 = new TreeNode("1.1");
    // var n2 = new TreeNode("2");
    // var n3 = new TreeNode("3");
    // var n31 = new TreeNode("3.1");
    // var n32 = new TreeNode("3.2");
    // var n321 = new TreeNode("3.2.1");
    // var n33 = new TreeNode("3.3");

    // root.addChild(n1);
    // root.addChild(n2);
    // root.addChild(n3);

    // n1.addChild(n11);

    // n3.addChild(n31);
    // n3.addChild(n32);
    // n3.addChild(n33);

    // n3.setEnabled(false);

    // n32.addChild(n321);

    // var view = new TreeView(root, "#tree_container");

</script>